<h1 align="center"> laravel-response </h1>

[ç®€ä½“ä¸­æ–‡](README.md) | [ENGLISH](README-EN.md)

> Provide a standardized and unified response data format for Laravel and Lumen API projects.

![Test](https://github.com/Jiannei/laravel-response/workflows/Test/badge.svg)
[![StyleCI](https://github.styleci.io/repos/316969462/shield?style=flat&branch=main)](https://github.styleci.io/repos/316969462?style=flat&branch=main)
[![Latest Stable Version](http://poser.pugx.org/jiannei/laravel-response/v)](https://packagist.org/packages/jiannei/laravel-response)
[![Total Downloads](http://poser.pugx.org/jiannei/laravel-response/downloads)](https://packagist.org/packages/jiannei/laravel-response)
[![Monthly Downloads](http://poser.pugx.org/jiannei/laravel-response/d/monthly)](https://packagist.org/packages/jiannei/laravel-response)
[![Latest Unstable Version](http://poser.pugx.org/jiannei/laravel-response/v/unstable)](https://packagist.org/packages/jiannei/laravel-response)
[![License](http://poser.pugx.org/jiannei/laravel-response/license)](https://packagist.org/packages/jiannei/laravel-response)

## Introduce

`laravel-response` It is mainly used to unify the response data format of "success", "failure" and "exception" in the process of API development.

It is encapsulated in the original `response() - > json()`, there is nothing complicated.

Follow certain specifications, return HTTP status codes that are easy to understand, and support the definition of 'enum' to meet the return of descriptive business operation codes in different scenarios.

## Features

- Unified data response format, including:`code`ã€`status`ã€`data`ã€`message`ã€`error`
- You can continue to chain call all public methods in the `JsonResponse` class, such as `Response::success()->header('x-foo ',' bar ')`
- Reasonably return the HTTP status code. The default is restful strict mode. You can configure to return 200 HTTP status code in case of exception (this is how most projects use it)
- It supports the formatting of `Api Resource`ã€`Api  Resource Collection`ã€`Paginator`ã€`LengthAwarePaginator`ã€`Eloquent\Model`ã€`Eloquent\Collection`,as well as the return of data in simple formats such as `array` å’Œ `string`
- According to the debug config, reasonably return the exception information, verify the exception information
- It supports modifying the status code or prompt information of laravel's special exception, such as modifying the exception prompt of `No query results for model` to `data not found`
- Any returned field can be displayed or hidden, and aliases can be set, such as alia `message` to `msg`
- The formatted result of paging data is consistent with the format converted by the transformer using `league/fractal` (DingoApi uses this extension for data conversion), that is, it can be smoothly switched from laravel API resource to `league/fractal`
- åˆ†é¡µæ•°æ®æ ¼å¼åŒ–åçš„ç»“æœä¸ä½¿ç”¨ `league/fractal` ï¼ˆDingoApi ä½¿ç”¨è¯¥æ‰©å±•è¿›è¡Œæ•°æ®è½¬æ¢ï¼‰çš„ transformer è½¬æ¢åçš„æ ¼å¼ä¿æŒä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥é¡ºæ»‘åœ°ä» Laravel Api Resource åˆ‡æ¢åˆ° `league/fractal`
- Built in HTTP standard status code support, and support the extension of ResponseCodeEnum to define response codes according to different business modules (optional, need to install `jiannei/laravel-enum`)

## Install

Support for laravel 5.5. *~ Laravel 9.*, the user-defined business operation code partially depends on [jiannei/laravel-enum](https://github.com/Jiannei/laravel-enum).

| laravel version | lumen version |  response version |  enum version  |
|-----------| ----  |  ----  |  ----  |
| 5.5.*     | 5.5.*  |  ~1.8  | ~1.4  |
| 6.*       | 6.* |  ^2.0  |  ~1.4  |
| 7.*       | 7.* |  ^3.0  |  ^2.0  |
| 8.* - 9.* | 8.*  - 9.* |  ^4.0  |  ^3.0  |


```shell
# laravel 5.5

composer require jiannei/laravel-response "~1.8" -vvv
composer require jiannei/laravel-enum "~1.4" -vvv # optional

# laravel 6.x

composer require jiannei/laravel-response "^2.0" -vvv
composer require jiannei/laravel-enum "~1.4" -vvv # optional

# laravel 7.x

composer require jiannei/laravel-response "^3.0" -vvv
composer require jiannei/laravel-enum "^2.0" -vvv # optional

# laravel 8.x - 9.x

composer require jiannei/laravel-response "^4.0" -vvv
composer require jiannei/laravel-enum "^3.0" -vvv # optional
```

## Configuration

### Laravel

- publish config file

```shell
$ php artisan vendor:publish --provider="Jiannei\Response\Laravel\Providers\LaravelServiceProvider"
```

- format exception response

```php
// app/Exceptions/Handler.php
// The exceptions generated by API requests will be formatted and returned
// The request header is required to contain /json or +json, such as Accept:application/json
// Or Ajax request, the header contains X-Requested-Withï¼šXMLHttpRequest;

<?php

namespace App\Exceptions;

use Illuminate\Foundation\Exceptions\Handler as ExceptionHandler;
use Throwable;
use Jiannei\Response\Laravel\Support\Traits\ExceptionTrait;

class Handler extends ExceptionHandler
{
    use ExceptionTrait;
    // ...
}
```

### Lumen

- Copy `vendor/jiannei/laravel-response/config/response.php` file to `config/response.php`

```bash
cp vendor/jiannei/laravel-response/config/response.php config/response.php
```

- load response configuration

```php
// bootstrap/app.php
$app->configure('response');
```

- format exception response

In `app/Exceptions/Handler.php` file `use Jiannei\Response\Laravel\Support\Traits\ExceptionTrait;`

In `app/Http/Controllers/Controller.php` file `use Jiannei\Response\Laravel\Support\Traits\ExceptionTrait;`

- register service provider

```php
$app->register(\Jiannei\Response\Laravel\Providers\LumenServiceProvider::class);
```

## Usage

The extension package itself provides rich unit test cases,you can unlock usage by viewing test cases [tests](https://github.com/Jiannei/laravel-response/tree/main/tests) ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹æµ‹è¯•ç”¨ä¾‹æ¥è§£é”ä½¿ç”¨æ–¹æ³•ã€‚

Or view the corresponding template projects:

- [laravel-api-starter](https://github.com/Jiannei/laravel-api-starter)
- [lumen-api-starter](https://github.com/Jiannei/lumen-api-starter)

### Successful response

#### Sample code

```php
<?php
// ...
public function index()
{
    $users = User::all();

    return Response::success(new UserCollection($users));
}

public function paginate()
{
    $users = User::paginate(5);

    return Response::success(new UserCollection($users));
}

public function simplePaginate()
{
    $users = User::simplePaginate(5);

    return Response::success(new UserCollection($users));
}

public function item()
{
    $user = User::first();

    return Response::success(new UserResource($user));
}

public function array()
{
    return Response::success([
        'name' => 'Jiannel',
        'email' => 'longjian.huang@foxmail.com'
    ],'', ResponseCodeEnum::SERVICE_REGISTER_SUCCESS);
}


```

#### Return all rows data

Support custom inner `data` field names, such as `rows` or `list`

```json
{
    "status": "success",
    "code": 200,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "data": [
            {
                "nickname": "Joaquin Ondricka",
                "email": "lowe.chaim@example.org"
            },
            {
                "nickname": "Jermain D'Amore",
                "email": "reanna.marks@example.com"
            },
            {
                "nickname": "Erich Moore",
                "email": "ernestine.koch@example.org"
            }
        ]
    },
    "error": {}
}
```

#### Paginator

Support custom inner `data` field names, such as `rows` or `list`

```json
{
    "status": "success",
    "code": 200,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "data": [
            {
                "nickname": "Joaquin Ondricka",
                "email": "lowe.chaim@example.org"
            },
            {
                "nickname": "Jermain D'Amore",
                "email": "reanna.marks@example.com"
            },
            {
                "nickname": "Erich Moore",
                "email": "ernestine.koch@example.org"
            },
            {
                "nickname": "Eva Quitzon",
                "email": "rgottlieb@example.net"
            },
            {
                "nickname": "Miss Gail Mitchell",
                "email": "kassandra.lueilwitz@example.net"
            }
        ],
        "meta": {
            "pagination": {
                "count": 5,
                "per_page": 5,
                "current_page": 1,
                "total": 12,
                "total_pages": 3,
                "links": {
                    "previous": null,
                    "next": "http://laravel-api.test/api/users/paginate?page=2"
                }
            }
        }
    },
    "error": {}
}
```

#### Simple Paginator

Support custom inner `data` field names, such as `rows` or `list`

```json
{
    "status": "success",
    "code": 200,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "data": [
            {
                "nickname": "Joaquin Ondricka",
                "email": "lowe.chaim@example.org"
            },
            {
                "nickname": "Jermain D'Amore",
                "email": "reanna.marks@example.com"
            },
            {
                "nickname": "Erich Moore",
                "email": "ernestine.koch@example.org"
            },
            {
                "nickname": "Eva Quitzon",
                "email": "rgottlieb@example.net"
            },
            {
                "nickname": "Miss Gail Mitchell",
                "email": "kassandra.lueilwitz@example.net"
            }
        ],
        "meta": {
            "pagination": {
                "count": 5,
                "per_page": 5,
                "current_page": 1,
                "links": {
                    "previous": null,
                    "next": "http://laravel-api.test/api/users/simple-paginate?page=2"
                }
            }
        }
    },
    "error": {}
}
```

#### Return one row data

```json
{
    "status": "success",
    "code": 200,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "nickname": "Joaquin Ondricka",
        "email": "lowe.chaim@example.org"
    },
    "error": {}
}
```

#### Other shortcuts

```php
Response::ok();// There is no need to return data, but only message
Response::localize(200101);// There is no need to return data, return message according to the response code
Response::accepted();
Response::created();
Response::noContent();
```

### Failure response

#### Do not specify message

```php
public function fail()
{
    Response::fail();// ä¸éœ€è¦åŠ  return
}
```

- localization is not configured

```json
{
    "status": "fail",
    "code": 500,
    "message": "Http internal server error",
    "data": {},
    "error": {}
}
```

- localization is configured

```json
{
    "status": "fail",
    "code": 500,
    "message": "æ“ä½œå¤±è´¥",
    "data": {},
    "error": {}
}
```

#### Specify message

```php
public function fail()
{
    Response::fail('error');// ä¸éœ€è¦åŠ  return
}
```

return response

```json
{
    "status": "fail",
    "code": 500,
    "message": "error",
    "data": {},
    "error": {}
}
```

#### Specify code

```php
public function fail()
{
    Response::fail('',ResponseCodeEnum::SERVICE_LOGIN_ERROR);
}
```

return response

```json
{
    "status": "fail",
    "code": 500102,
    "message": "ç™»å½•å¤±è´¥",
    "data": {},
    "error": {}
}
```

#### Other shortcuts

```php
Response::errorBadRequest();
Response::errorUnauthorized();
Response::errorForbidden();
Response::errorNotFound();
Response::errorMethodNotAllowed();
Response::errorInternal();
```

### Exception response

#### Form validation exception

```json
{
    "status": "error",
    "code": 422,
    "message": "éªŒè¯å¤±è´¥",
    "data": {},
    "error": {
        "email": [
            "The email field is required."
        ]
    }
}
```

#### An exception is thrown outside the controller

You can throw an `HttpException`  using the `abort` helper function

```php
abort(500102,'ç™»å½•å¤±è´¥');

// return response
{
    "status": "fail",
    "code": 500102,
    "message": "ç™»å½•å¤±è´¥",
    "data": {},
    "error": {}
}
```

#### Other exceptions

enable debug mode(`APP_DEBUG=true`)

```json
{
    "status": "error",
    "code": 404,
    "message": "Http not found",
    "data": {},
    "error": {
        "message": "",
        "exception": "Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException",
        "file": "/home/vagrant/code/laravel-api-starter/vendor/laravel/framework/src/Illuminate/Routing/AbstractRouteCollection.php",
        "line": 43,
        "trace": [
            {
                "file": "/home/vagrant/code/laravel-api-starter/vendor/laravel/framework/src/Illuminate/Routing/RouteCollection.php",
                "line": 162,
                "function": "handleMatchedRoute",
                "class": "Illuminate\\Routing\\AbstractRouteCollection",
                "type": "->"
            },
            {
                "file": "/home/vagrant/code/laravel-api-starter/vendor/laravel/framework/src/Illuminate/Routing/Router.php",
                "line": 646,
                "function": "match",
                "class": "Illuminate\\Routing\\RouteCollection",
                "type": "->"
            }
        ]
    }
}
```

disable debug mode(`APP_DEBUG=false`)

```json
{
    "status": "error",
    "code": 404,
    "message": "Http not found",
    "data": {},
    "error": {}
}
```

### Custom business code

```php
<?php
namespace App\Enums;

use Jiannei\Enum\Laravel\Repositories\Enums\HttpStatusCodeEnum;

class ResponseCodeEnum extends HttpStatusCodeEnum
{
    // success code,Start with 1xxã€2xxã€3xx
    const SERVICE_REGISTER_SUCCESS = 200101;
    const SERVICE_LOGIN_SUCCESS = 200102;

    // client error code,Start with 400 ~ 499
    const CLIENT_PARAMETER_ERROR = 400001;
    const CLIENT_CREATED_ERROR = 400002;
    const CLIENT_DELETED_ERROR = 400003;
    const CLIENT_VALIDATION_ERROR = 422001; // form validation error

    // service error code,Start with 500 ~ 599
    const SYSTEM_ERROR = 500001;
    const SYSTEM_UNAVAILABLE = 500002;
    const SYSTEM_CACHE_CONFIG_ERROR = 500003;
    const SYSTEM_CACHE_MISSED_ERROR = 500004;
    const SYSTEM_CONFIG_ERROR = 500005;
}
```

### Localized code description

```php
<?php
// lang/zh_CN/enums.php
use App\Repositories\Enums\ResponseCodeEnum;

return [
    // å“åº”çŠ¶æ€ç 
    ResponseCodeEnum::class => [
        // æˆåŠŸ
        ResponseCodeEnum::HTTP_OK => 'æ“ä½œæˆåŠŸ', // è‡ªå®šä¹‰ HTTP çŠ¶æ€ç è¿”å›æ¶ˆæ¯
        ResponseCodeEnum::HTTP_INTERNAL_SERVER_ERROR => 'æ“ä½œå¤±è´¥', // è‡ªå®šä¹‰ HTTP çŠ¶æ€ç è¿”å›æ¶ˆæ¯
        ResponseCodeEnum::HTTP_UNAUTHORIZED => 'æˆæƒå¤±è´¥',

        // ä¸šåŠ¡æ“ä½œæˆåŠŸ
        ResponseCodeEnum::SERVICE_REGISTER_SUCCESS => 'æ³¨å†ŒæˆåŠŸ',
        ResponseCodeEnum::SERVICE_LOGIN_SUCCESS => 'ç™»å½•æˆåŠŸ',

        // å®¢æˆ·ç«¯é”™è¯¯
        ResponseCodeEnum::CLIENT_PARAMETER_ERROR => 'å‚æ•°é”™è¯¯',
        ResponseCodeEnum::CLIENT_CREATED_ERROR => 'æ•°æ®å·²å­˜åœ¨',
        ResponseCodeEnum::CLIENT_DELETED_ERROR => 'æ•°æ®ä¸å­˜åœ¨',
        ResponseCodeEnum::CLIENT_VALIDATION_ERROR => 'è¡¨å•éªŒè¯é”™è¯¯',

        // æœåŠ¡ç«¯é”™è¯¯
        ResponseCodeEnum::SYSTEM_ERROR => 'æœåŠ¡å™¨é”™è¯¯',
        ResponseCodeEnum::SYSTEM_UNAVAILABLE => 'æœåŠ¡å™¨æ­£åœ¨ç»´æŠ¤ï¼Œæš‚ä¸å¯ç”¨',
        ResponseCodeEnum::SYSTEM_CACHE_CONFIG_ERROR => 'ç¼“å­˜é…ç½®é”™è¯¯',
        ResponseCodeEnum::SYSTEM_CACHE_MISSED_ERROR => 'ç¼“å­˜æœªå‘½ä¸­',
        ResponseCodeEnum::SYSTEM_CONFIG_ERROR => 'ç³»ç»Ÿé…ç½®é”™è¯¯',

        // ä¸šåŠ¡æ“ä½œå¤±è´¥ï¼šæˆæƒä¸šåŠ¡
        ResponseCodeEnum::SERVICE_REGISTER_ERROR => 'æ³¨å†Œå¤±è´¥',
        ResponseCodeEnum::SERVICE_LOGIN_ERROR => 'ç™»å½•å¤±è´¥',
    ],
];
```

## Project supported by JetBrains

Many thanks to Jetbrains for kindly providing a license for me to work on this and other open-source projects.

[![](https://resources.jetbrains.com/storage/products/company/brand/logos/jb_beam.svg)](https://www.jetbrains.com/?from=https://github.com/jiannei)

## Contributors âœ¨

Thanks goes to these wonderful people ([emoji key](https://allcontributors.org/docs/en/emoji-key)):

<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->
<!-- prettier-ignore-start -->
<!-- markdownlint-disable -->
<table>
  <tr>
    <td align="center"><a href="https://github.com/vanthao03596"><img src="https://avatars.githubusercontent.com/u/34786441?v=4?s=100" width="100px;" alt=""/><br /><sub><b>Pham Thao</b></sub></a><br /><a href="#design-vanthao03596" title="Design">ğŸ¨</a></td>
    <td align="center"><a href="https://www.guanguans.cn"><img src="https://avatars.githubusercontent.com/u/22309277?v=4?s=100" width="100px;" alt=""/><br /><sub><b>guanguans</b></sub></a><br /><a href="https://github.com/jiannei/laravel-response/issues?q=author%3Aguanguans" title="Bug reports">ğŸ›</a></td>
  </tr>
</table>

<!-- markdownlint-restore -->
<!-- prettier-ignore-end -->

<!-- ALL-CONTRIBUTORS-LIST:END -->

This project follows the [all-contributors](https://github.com/all-contributors/all-contributors) specification. Contributions of any kind welcome!

## Stargazers over time

[![Stargazers over time](https://starchart.cc/jiannei/laravel-response.svg)](https://starchart.cc/jiannei/laravel-response)

## License

The MIT License (MIT). Please see [License File](LICENSE) for more information.